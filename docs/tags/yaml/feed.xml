<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>yaml on tellme.tokyo</title>
    <link>https://tellme.tokyo/tags/yaml/</link>
    <description>Recent content in yaml on tellme.tokyo</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-jp</language>
    <copyright>BABAROT All Right Reserved.</copyright>
    <lastBuildDate>Tue, 19 Feb 2019 21:40:24 +0900</lastBuildDate>
    
	<atom:link href="https://tellme.tokyo/tags/yaml/feed.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Kubernetes などの YAML を独自のルールをもとにテストする</title>
      <link>https://tellme.tokyo/post/2019/02/19/test-kubernetes-yaml/</link>
      <pubDate>Tue, 19 Feb 2019 21:40:24 +0900</pubDate>
      
      <guid>https://tellme.tokyo/post/2019/02/19/test-kubernetes-yaml/</guid>
      <description>設定ファイルのメンテナンスの必要性 Infrastructure as Code の普及もありインフラの状態やその他多くの設定が、設定ファイル言語 (YAML や HCL など) で記述されることが多くなった。 Terraform HCL や Kubernetes YAML など、人が継続的にメンテナンスしなければならなく、その設定が直接プロダクションに影響を与える場合、そのレビューがとても重要になる。 具体的に例えば、「デプロイする Replica の数」や「Resource limit や PodDisruptionBudget が適切か」などレビューの中で注意深く見なけれなならない点などがあげられる。 加えて日々のレビューの中で、問題にはならないが「Kubernetes の metadata.namespace は省略できるけど事故防止の意味も込めて明示的に書きましょう」といった設定ファイルに対して強制させたいポリシーなどが生まれて、ひとつのレビュー観点になっていくことは自然である。
人がレビューの中で毎回見なければならないこと、毎回指摘すること、機械的にチェックできることはルールセットを定義して、それをもとに lint でチェックして CI で失敗させるのが効率的である。
YAML などのただの設定ファイル言語に対して「独自のルールを定義してそれをもとにテストする」ということは実は難しかったりする。
 garethr/kubeval: Validate your Kubernetes configuration files, supports multiple Kubernetes versions viglesiasce/kube-lint: A linter for Kubernetes resources with a customizable rule set  kubeval はマニフェストファイルの validator として機能する。例えば、integer として定義しなければいけないフィールドを string で定義していた場合に検知することができる。 kube-lint は決められた Kind (現在は Pod のみ) の決められたフィールドのチェックを決められたオペレータ (equal, not equal など) で違反していないかチェックすることができる。</description>
    </item>
    
    <item>
      <title>GitHub のラベルを宣言的に管理する</title>
      <link>https://tellme.tokyo/post/2018/11/19/github-label-management/</link>
      <pubDate>Mon, 19 Nov 2018 20:08:07 +0900</pubDate>
      
      <guid>https://tellme.tokyo/post/2018/11/19/github-label-management/</guid>
      <description>ソフトウェアの宣言的設定について &amp;ldquo;何かを管理する&amp;rdquo;となったときに、宣言的に設定できるようになっていると非常に便利である。 この宣言的設定 (Infrastructure as Code) とは、イミュータブルなインフラ (Immutable Infrastructure) を作るための基本的な考え方で、システムの状態を設定ファイルにて宣言するという考え方である。 具体的には Kubernetes のマニフェストファイル (YAML) だったり、Terraform のコード (HCL) が挙げられる。 この考え方は、インフラ領域に限らず、何らかの状態管理にはもってこいの手法である。
GitHub のラベルは Issues/P-Rs を管理するために便利な機能である。 しかし、リポジトリの規模やラベルの数が増えてくると、ラベル自体も管理する必要が出てくる。 実際に Kubernetes 規模のリポジトリになると、ラベル管理なしにはやっていられない。 ラベルを管理するための bot やツールすら動いている。 実際に Kubernetes のコミュニティでは現在 180 個近くのラベルが定義されており、同様のラベルが導入されているリポジトリが数十個ある。
 Labels - kubernetes/community  1つのリポジトリのラベルを管理するくらいならマニュアルでも可能だが、複数リポジトリとなるとリポジトリ間の同期が大変になってくる。 特に ZenHub などの GitHub Issues を使ったマネジメントをしている場合、ラベル名が一致されていることとその付随情報 (色や説明) の同期が必須になる。 人間が手で追加や変更をしていると、必ず差異が発生する。
ここで、冒頭に挙げた宣言的設定が有効な手段になる。
github-labeler の紹介 https://github.com/b4b4r07/github-labeler
宣言的設定の手法をラベル管理に持ち込むために、GitHub ラベルの定義とそれを作るリポジトリについて「YAML に書いたとおりになる」ツールを書いた。
例えば次のような YAML を書く。
labels:-name:area/securitydescription:Indicatesanissueonsecurityarea.color:1d76db-name:kind/bugdescription:CategorizesissueorPRasrelatedtoabug.color:d93f0b-name:kind/cleanupdescription:CategorizesissueorPRasrelatedtocleaningupcode,process,ortechnicaldebt.color:bfd4f2-name:kind/designdescription:CategorizesissueorPRasrelatedtodesign.color:bfd4f2-name:kind/documentationdescription:CategorizesissueorPRasrelatedtodocumentation.color:bfd4f2repos:-name:org/repo1labels:-area/security-kind/api-change-kind/bug-kind/cleanup-kind/design-name:org/repo2labels:-kind/api-change-kind/bug-kind/cleanup-kind/design この YAML をもとに github-labeler を実行すると、こんな感じになる。
$ github-labeler 2018/11/19 18:30:40 create &amp;#34;area/security&amp;#34; in org/repo1 2018/11/19 18:30:40 create &amp;#34;kind/api-change&amp;#34; in org/repo1 2018/11/19 18:30:40 create &amp;#34;kind/bug&amp;#34; in org/repo1 2018/11/19 18:30:40 create &amp;#34;kind/cleanup&amp;#34; in org/repo1 2018/11/19 18:30:40 create &amp;#34;kind/design&amp;#34; in org/repo1 2018/11/19 18:30:41 create &amp;#34;kind/documentation&amp;#34; in org/repo1 2018/11/19 18:30:42 delete &amp;#34;bug&amp;#34; in org/repo1 2018/11/19 18:30:42 delete &amp;#34;deplicate&amp;#34; in org/repo1 2018/11/19 18:30:42 delete &amp;#34;enhancement&amp;#34; in org/repo1 2018/11/19 18:30:42 delete &amp;#34;good first issue&amp;#34; in org/repo1 2018/11/19 18:30:42 delete &amp;#34;help wanted&amp;#34; in org/repo1 2018/11/19 18:30:42 delete &amp;#34;invalid&amp;#34; in org/repo1 2018/11/19 18:30:42 delete &amp;#34;question&amp;#34; in org/repo1 2018/11/19 18:30:42 delete &amp;#34;wontfix&amp;#34; in org/repo1 定義されたラベル (.</description>
    </item>
    
  </channel>
</rss>